@page "/comparativo/{ListaId:int}"

@inherits BasePageComponent

@using Dtos
@using MaterialeShop.Admin.Src.Shared.Components

<PageTitle>MaterialeShop - Orçamentos</PageTitle>

<AppBarCustom />

<div class="px-2 px-sm-8 px-md-16 pt-6 pt-sm-8 pt-md-8">

    <MudText Typo="Typo.h5">Comparativo de orçamentos</MudText>
    <br>

    @if( (_ListaItemList == null || !_ListaItemList.Any()) && 
            (_OrcamentoViewList == null || !_OrcamentoViewList.Any()) &&
            (_OrcamentoItemList == null || !_OrcamentoItemList.Any()) )
    {
        <MudSkeleton />
    } else
    {
        <MudSimpleTable Hover="true" Bordered="true" Striped="true" Style="overflow-x: auto;" Outlined="false" Class="espaco-borda">
            <thead>

                <tr>
                    <th Class="borda-remove"></th>
                    <th Class="borda-remove"></th>
                    <th Class="borda-remove"></th>
                    @foreach (OrcamentoView item in _OrcamentoViewList)
                    {
                        <th Class="borda-remove"></th>
                        <th colspan="3" Class="borda-remove">
                            <MudText Align="Align.Center" Typo="Typo.subtitle2">
                                @if(maisBarato == item.OrcamentoId)
                                {
                                    <span class="marcador-mais-barato">Mais barato</span>
                                    <span>&nbsp;</span>
                                }
                                @if(maisQuantidadeItens == item.OrcamentoId)
                                {
                                    <span class="marcador-mais-completo">Mais completo</span>
                                }
                            </MudText>
                        </th>
                    }
                </tr>

                <tr>
                    <th></th>
                    <th></th>
                    <th></th>
                    @foreach (OrcamentoView item in _OrcamentoViewList)
                    {
                        <th Class="borda-remove"></th>
                        <th colspan="3" Class="borda-todas"><MudText Align="Align.Center"><b>@item.LojaNome</b></MudText></th>
                    }
                </tr>
                
                <tr>
                    <th><MudText Align="Align.Center">#</MudText></th>
                    <th><MudText Align="Align.Center">Quantidade <br>solicitada</MudText></th>
                    <th Class="borda-right"><MudText Align="Align.Center">Produto</MudText></th>

                    @foreach (OrcamentoView item in _OrcamentoViewList)
                    {
                        <th Class="borda-remove"></th>
                        <th Class="borda-left"><MudText Align="Align.Center">Quantidade <br>ofertada</MudText></th>
                        <th><MudText Align="Align.Center">Preço <br>unitário</MudText></th>
                        <th Class="borda-right"><MudText Align="Align.Center">Preço <br>total</MudText></th>
                    }
                </tr>
            </thead>
            <tbody>
                @if(tabelaComparativa is null)
                {
                    <MudSkeleton></MudSkeleton>
                } else
                {
                    int aux_coluna;
                    int numero_ordem_itens=0;
                    @foreach (var linha in tabelaComparativa)
                    {
                        aux_coluna=2; //começa em 2 pq a primeira coluna eh o numero de ordem dos itens e eh inserida antes dos foreach
                        numero_ordem_itens++;
                        <tr>
                            <td class="center-text">@numero_ordem_itens</td>
                            @foreach (var coluna in linha)
                            {
                                if (aux_coluna % 4 == 0) 
                                {
                                    aux_coluna++;
                                    // coluna de separação
                                    <td Class="borda-remove"></td>
                                }

                                switch (coluna.TipoColuna)
                                {
                                    case TipoColuna.QuantidadeSolicitada:
                                        <td><MudText Align="Align.Center" Typo="Typo.body2">@coluna.Conteudo</MudText></td>
                                        break;
                                    case TipoColuna.ProdutoSolicitado:
                                        <td><MudText Align="Align.Left" Typo="Typo.body2">@coluna.Conteudo</MudText></td>
                                        break;
                                    case TipoColuna.Quantidadeofertada:
                                        <td><MudText Align="Align.Center" Typo="Typo.body2">@coluna.Conteudo</MudText></td>
                                        break;
                                    case TipoColuna.PrecoUnitario:
                                        <td><MudText Align="Align.Right" Typo="Typo.body2">@coluna.Conteudo</MudText></td>
                                        break;
                                    case TipoColuna.PrecoTotal:
                                        <td><MudText Align="Align.Right" Typo="Typo.body2">@coluna.Conteudo</MudText></td>
                                        break;
                                }
                                aux_coluna++;

                            }
                        </tr>
                    }
                }

                <tr>
                    <td Class="borda-remove-todas"></td>
                    <td Class="borda-remove-todas"></td>
                    <td Class="borda-remove-todas"></td>
                    @foreach (OrcamentoView item in _OrcamentoViewList)
                    {
                        <td Class="borda-remove"></td>
                        <td colspan="2"><MudText Align="Align.Center" Typo="Typo.body2">Prazo de entrega</MudText></td>
                        <td><MudText Align="Align.Center" Typo="Typo.body2">@item.EntregaPrazo</MudText></td>
                    }
                </tr>

                <tr>
                    <td Class="borda-remove-todas"></td>
                    <td Class="borda-remove-todas"></td>
                    <td Class="borda-remove-todas"></td>
                    @foreach (OrcamentoView item in _OrcamentoViewList)
                    {
                        <td Class="borda-remove"></td>
                        <td colspan="2"><MudText Align="Align.Center" Typo="Typo.body2">Taxa de entrega</MudText></td>
                        <td><MudText Align="Align.Right" Typo="Typo.body2">@("R$"+String.Format("{0:0.00}", item.EntregaPreco))</MudText></td>
                    }
                </tr>

                <tr>
                    <td Class="borda-remove-todas"></td>
                    <td Class="borda-remove-todas"></td>
                    <td Class="borda-remove-todas"></td>
                    @foreach (OrcamentoView item in _OrcamentoViewList)
                    {
                        <td Class="borda-remove"></td>
                        <td colspan="2"><MudText Align="Align.Center" Typo="Typo.body2"><b>Total sem preço de entrega</b></MudText></td>
                        <td><MudText Align="Align.Right" Typo="Typo.body2"><b>@("R$"+String.Format("{0:0.00}", item.PrecoTotalSemEntrega))</b></MudText></td>
                    }
                </tr>

                <tr>
                    <td Class="borda-remove-todas"></td>
                    <td Class="borda-remove-todas"></td>
                    <td Class="borda-remove-todas"></td>
                    @foreach (OrcamentoView item in _OrcamentoViewList)
                    {
                        <td Class="borda-remove"></td>
                        <td colspan="2"><MudText Align="Align.Center" Typo="Typo.body2"><b>Total com preço de entrega</b></MudText></td>
                        <td><MudText Align="Align.Right" Typo="Typo.body2"><b>@("R$"+String.Format("{0:0.00}", (item.EntregaPreco + item.PrecoTotalComEntrega)))</b></MudText></td>
                    }
                </tr>

            </tbody>
        </MudSimpleTable>
    }

    <br>
    <br>
    <br>
    <br>
    <br>

</div>

<style>
    .borda-todas {
        border: 1px solid var(--mud-palette-table-lines);
    }
    
    .borda-left {
        border-left: 1px solid var(--mud-palette-table-lines);
    }
    
    .borda-right {
        border-right: 1px solid var(--mud-palette-table-lines);
    }
    
    .borda-remove {
        border-top: 0px !important;
        border-bottom: 0px !important;
    }
    
    .borda-remove-todas {
        border: 0px !important;
    }

    .marcador-mais-barato {
        padding-top: 5px;
        padding-bottom: 5px;
        padding-left: 8px;
        padding-right: 8px;

        background-color: green;
        color: white;
    }
    
    .marcador-mais-completo {
        padding-top: 5px;
        padding-bottom: 5px;
        padding-left: 8px;
        padding-right: 8px;

        background-color: purple;
        color: white;
    }

    td, th {
        padding: 8px !important;
    }

    .center-text {
        text-align: center !important;
    }

</style>